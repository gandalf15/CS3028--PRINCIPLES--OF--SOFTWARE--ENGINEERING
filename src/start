#!/bin/bash
# Description: Shell-script to start rails server

# To romove created containers execute "docker-compose down"

read -r -p "Would you like to rebuild the docker image? [y/N] " response
if [[ "$response" =~ ^([yY][eE][sS]|[yY])+$ ]]
then
	if [[ -n "$HTTP_PROXY" ]]
	then
		read -r -p "Would you like}ike to NOT build the rails container behind the University proxy server? [y/N] " response
		if [[ "$response" =~ ^([yY][eE][sS]|[yY])+$ ]]
		then
			docker-compose build
		else
	  		docker-compose -f docker-compose-proxy.yml build
		fi
	else
		docker-compose build
	fi
fi

read -r -p "Would you like to run \"rails db:drop db:create db:migrate\"? [y/N] " response
if [[ "$response" =~ ^([yY][eE][sS]|[yY])+$ ]]
then
  docker-compose run web bash -c "rails db:drop && rails db:create && rails db:migrate"
fi
echo ''
echo 'Starting containers ....'
docker-compose up
